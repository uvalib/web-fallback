import{P as e,B as t,c as s,h as r}from"./uvalib-ui-base-6ae119bb.js";import"./app-localstorage-document-f3503647.js";
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/e({is:"iron-request",hostAttributes:{hidden:!0},properties:{xhr:{type:Object,notify:!0,readOnly:!0,value:function(){return new XMLHttpRequest}},response:{type:Object,notify:!0,readOnly:!0,value:function(){return null}},status:{type:Number,notify:!0,readOnly:!0,value:0},statusText:{type:String,notify:!0,readOnly:!0,value:""},completes:{type:Object,readOnly:!0,notify:!0,value:function(){return new Promise(function(e,t){this.resolveCompletes=e,this.rejectCompletes=t}.bind(this))}},progress:{type:Object,notify:!0,readOnly:!0,value:function(){return{}}},aborted:{type:Boolean,notify:!0,readOnly:!0,value:!1},errored:{type:Boolean,notify:!0,readOnly:!0,value:!1},timedOut:{type:Boolean,notify:!0,readOnly:!0,value:!1}},get succeeded(){if(this.errored||this.aborted||this.timedOut)return!1;var e=this.xhr.status||0;return 0===e||e>=200&&e<300},send:function(e){var s=this.xhr;if(s.readyState>0)return null;s.addEventListener("progress",function(e){this._setProgress({lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total}),this.fire("iron-request-progress-changed",{value:this.progress})}.bind(this)),s.addEventListener("error",function(t){this._setErrored(!0),this._updateStatus();var s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),s.addEventListener("timeout",function(t){this._setTimedOut(!0),this._updateStatus();var s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),s.addEventListener("abort",function(){this._setAborted(!0),this._updateStatus();var t=new Error("Request aborted."),s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),s.addEventListener("loadend",function(){if(this._updateStatus(),this._setResponse(this.parseResponse()),this.succeeded)this.resolveCompletes(this);else{var t=new Error("The request failed with status code: "+this.xhr.status),s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}}.bind(this)),this.url=e.url;var r=!1!==e.async;s.open(e.method||"GET",e.url,r);var n={json:"application/json",text:"text/plain",html:"text/html",xml:"application/xml",arraybuffer:"application/octet-stream"}[e.handleAs],i=e.headers||Object.create(null),o=Object.create(null);for(var a in i)o[a.toLowerCase()]=i[a];if(i=o,n&&!i.accept&&(i.accept=n),Object.keys(i).forEach((function(e){/[A-Z]/.test(e)&&t._error("Headers must be lower case, got",e),s.setRequestHeader(e,i[e])}),this),r){s.timeout=e.timeout;var u=e.handleAs;!e.jsonPrefix&&u||(u="text"),s.responseType=s._responseType=u,e.jsonPrefix&&(s._jsonPrefix=e.jsonPrefix)}s.withCredentials=!!e.withCredentials;var l=this._encodeBodyObject(e.body,i["content-type"]);return s.send(l),this.completes},parseResponse:function(){var e=this.xhr,t=e.responseType||e._responseType,s=!this.xhr.responseType,r=e._jsonPrefix&&e._jsonPrefix.length||0;try{switch(t){case"json":if(s||void 0===e.response)try{return JSON.parse(e.responseText)}catch(t){return console.warn("Failed to parse JSON sent from "+e.responseURL),null}return e.response;case"xml":return e.responseXML;case"blob":case"document":case"arraybuffer":return e.response;case"text":default:if(r)try{return JSON.parse(e.responseText.substring(r))}catch(t){return console.warn("Failed to parse JSON sent from "+e.responseURL),null}return e.responseText}}catch(e){this.rejectCompletes(new Error("Could not parse response. "+e.message))}},abort:function(){this._setAborted(!0),this.xhr.abort()},_encodeBodyObject:function(e,t){if("string"==typeof e)return e;var s=e;switch(t){case"application/json":return JSON.stringify(s);case"application/x-www-form-urlencoded":return this._wwwFormUrlEncode(s)}return e},_wwwFormUrlEncode:function(e){if(!e)return"";var t=[];return Object.keys(e).forEach((function(s){t.push(this._wwwFormUrlEncodePiece(s)+"="+this._wwwFormUrlEncodePiece(e[s]))}),this),t.join("&")},_wwwFormUrlEncodePiece:function(e){return null!=e&&e.toString?encodeURIComponent(e.toString().replace(/\r?\n/g,"\r\n")).replace(/%20/g,"+"):""},_updateStatus:function(){this._setStatus(this.xhr.status),this._setStatusText(void 0===this.xhr.statusText?"":this.xhr.statusText)}}),
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
e({is:"iron-ajax",hostAttributes:{hidden:!0},properties:{url:{type:String},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:{type:String,value:null},body:{type:Object,value:null},sync:{type:Boolean,value:!1},handleAs:{type:String,value:"json"},withCredentials:{type:Boolean,value:!1},timeout:{type:Number,value:0},auto:{type:Boolean,value:!1},verbose:{type:Boolean,value:!1},lastRequest:{type:Object,notify:!0,readOnly:!0},lastProgress:{type:Object,notify:!0,readOnly:!0},loading:{type:Boolean,notify:!0,readOnly:!0},lastResponse:{type:Object,notify:!0,readOnly:!0},lastError:{type:Object,notify:!0,readOnly:!0},activeRequests:{type:Array,notify:!0,readOnly:!0,value:function(){return[]}},debounceDuration:{type:Number,value:0,notify:!0},jsonPrefix:{type:String,value:""},bubbles:{type:Boolean,value:!1},rejectWithRequest:{type:Boolean,value:!1},_boundHandleResponse:{type:Function,value:function(){return this._handleResponse.bind(this)}}},observers:["_requestOptionsChanged(url, method, params.*, headers, contentType, body, sync, handleAs, jsonPrefix, withCredentials, timeout, auto)"],created:function(){this._boundOnProgressChanged=this._onProgressChanged.bind(this)},get queryString(){var e,t,s=[];for(e in this.params)if(t=this.params[e],e=window.encodeURIComponent(e),Array.isArray(t))for(var r=0;r<t.length;r++)s.push(e+"="+window.encodeURIComponent(t[r]));else null!==t?s.push(e+"="+window.encodeURIComponent(t)):s.push(e);return s.join("&")},get requestUrl(){var e=this.queryString,t=this.url||"";if(e){var s=t.indexOf("?")>=0?"&":"?";return t+s+e}return t},get requestHeaders(){var e,t={},s=this.contentType;if(null==s&&"string"==typeof this.body&&(s="application/x-www-form-urlencoded"),s&&(t["content-type"]=s),"object"==typeof this.headers)for(e in this.headers)t[e]=this.headers[e].toString();return t},_onProgressChanged:function(e){this._setLastProgress(e.detail.value)},toRequestOptions:function(){return{url:this.requestUrl||"",method:this.method,headers:this.requestHeaders,body:this.body,async:!this.sync,handleAs:this.handleAs,jsonPrefix:this.jsonPrefix,withCredentials:this.withCredentials,timeout:this.timeout,rejectWithRequest:this.rejectWithRequest}},generateRequest:function(){var e=document.createElement("iron-request"),t=this.toRequestOptions();return this.push("activeRequests",e),e.completes.then(this._boundHandleResponse).catch(this._handleError.bind(this,e)).then(this._discardRequest.bind(this,e)),this.fire("iron-ajax-presend",{request:e,options:t},{bubbles:this.bubbles,cancelable:!0}).defaultPrevented?(e.abort(),e.rejectCompletes(e),e):(this.lastRequest&&this.lastRequest.removeEventListener("iron-request-progress-changed",this._boundOnProgressChanged),e.addEventListener("iron-request-progress-changed",this._boundOnProgressChanged),e.send(t),this._setLastProgress(null),this._setLastRequest(e),this._setLoading(!0),this.fire("request",{request:e,options:t},{bubbles:this.bubbles,composed:!0}),this.fire("iron-ajax-request",{request:e,options:t},{bubbles:this.bubbles,composed:!0}),e)},_handleResponse:function(e){e===this.lastRequest&&(this._setLastResponse(e.response),this._setLastError(null),this._setLoading(!1)),this.fire("response",e,{bubbles:this.bubbles,composed:!0}),this.fire("iron-ajax-response",e,{bubbles:this.bubbles,composed:!0})},_handleError:function(e,s){this.verbose&&t._error(s),e===this.lastRequest&&(this._setLastError({request:e,error:s,status:e.xhr.status,statusText:e.xhr.statusText,response:e.xhr.response}),this._setLastResponse(null),this._setLoading(!1)),this.fire("iron-ajax-error",{request:e,error:s},{bubbles:this.bubbles,composed:!0}),this.fire("error",{request:e,error:s},{bubbles:this.bubbles,composed:!0})},_discardRequest:function(e){var t=this.activeRequests.indexOf(e);t>-1&&this.splice("activeRequests",t,1)},_requestOptionsChanged:function(){this.debounce("generate-request",(function(){null!=this.url&&this.auto&&this.generateRequest()}),this.debounceDuration)}});window.customElements.define("uvalib-model-ajax",class extends s{static get template(){return r`
      <style>
        :host { display: none; }
      </style>
      <iron-ajax id="ajax" auto="[[auto]]" url="[[_url]]" handle-as="[[_requestType]]" loading="{{loading}}" last-response="{{_lastResponse}}" on-response="_reqFinished" headers="[[_headers]]"></iron-ajax>
    `}static get properties(){return{_url:{type:String,computed:"_makeURL(path,apiVersion)"},auto:{type:Boolean,value:!0},path:{type:String,value:""},loading:{type:Boolean,notify:!0},_lastResponse:{type:Object,observer:"_parseResponse"},lastResponse:{type:Object,notify:!0,readOnly:!0},apiVersion:{type:String,value:"v1"},poll:Number,csv:{type:Boolean,value:!1,observer:"_CSVobserver"},_requestType:{type:String,computed:"_typeOfRequest(csv)"},_contentType:String,_apidomain:{type:String,value:"https://api.devhub.virginia.edu/"},items:{type:Array,computed:"_getItems(lastResponse,filter,sortBy)",notify:!0},sortBy:String,sortOrder:{type:String,value:"asc"},filter:Object}}generateRequest(){this.$.ajax.generateRequest()}_getItems(e){if(Array.isArray(e)){var t=this.lastResponse;return this.filter&&(t=_.filter(t,this.filter)),this.sortBy&&(t=_.orderBy(t,this.sortBy,this.sortOrder)),t}return null}getHash(e,t){if(Array.isArray(this.lastResponse)){var s={};return this.lastResponse.forEach(function(r){r[e]&&(s[r[e]]={},t.forEach(t=>{s[r[e]][t]=r[t]}))}.bind(this)),s}return{}}_CSVobserver(){this._headers={accept:"application/json"}}_parseResponse(){this.csv?this._setLastResponse(Papa.parse(this._lastResponse,{header:!0,skipEmptyLines:!0}).data):this._setLastResponse(this._lastResponse)}_typeOfRequest(e){return e?"text":"json"}_makeURL(e,t){return this._apidomain+t+"/"+e}_reqFinished(){this.poll&&(this._timeout=setTimeout(function(){this.shadowRoot.querySelector("#ajax").generateRequest(),this._timeout=null}.bind(this),this.poll))}});class n extends(customElements.get("uvalib-model-ajax")){static get properties(){return{item:{type:Object,computed:"_makeItem(lastResponse,uuid,items)",notify:!0},uuid:{type:String},returnFirst:{type:Boolean,value:!0},firebase:{type:Boolean,value:!1}}}_makeURL(e,t){return this.firebase?"https://uvalib-api.firebaseio.com/"+e+".json":this._apidomain+t+"/library/"+e}_makeItem(e,t){if(this.lastResponse&&this.lastResponse.length>0)return t?this.lastResponse.find(e=>e.uuid==t):this.returnFirst?this.lastResponse[0]:null}}window.customElements.define("uvalib-model-library",n);class i extends(customElements.get("uvalib-model-library")){static get template(){return r`
      <div>${super.template}</div>
      <app-localstorage-document key="uvalib-alerts-seen" data="{{seen}}"></app-localstorage-document>
    `}static get properties(){return{lastResponse:{type:Array,observer:"_copyAlerts"},alerts:{type:Array,notify:!0,value:function(){return[]}},seen:{type:Array,notify:!0,observer:"_evalAlerts",value:[]},poll:{type:Number,value:3e5},seenCount:{type:Number,notify:!0,computed:"_getSeenCount(alerts,_force)"},_force:{type:Boolean,value:!0}}}_copyAlerts(){Array.isArray(this.lastResponse)&&this.lastResponse.length>0&&this.set("alerts",this.lastResponse.map(function(e){return"alert3"===e.severity&&this.setSeen(e.uuid),this.seen.indexOf(e.uuid)>-1?e.seen=!0:e.seen=!1,e}.bind(this)).sort((function(e,t){return e.severity>t.severity})))}setAllSeen(){this.alerts.forEach(e=>{this.setSeen(e.uuid)})}setSeen(e){var t=this.seen;-1===t.indexOf(e)&&t.push(e),this.set("seen",[]),this.set("seen",t)}_evalAlerts(){Array.isArray(this.alerts)&&this.alerts.length>0&&this.alerts.forEach(function(e,t){this.seen.indexOf(e.uuid)>-1&&!this.alerts[t].seen?(this.set("alerts."+t+".seen",!0),this.set("_force",!this._force)):this.alerts[t].seen&&(this.set("alerts."+t+".seen",!1),this.set("_force",!this._force))}.bind(this))}_makeURL(e,t){return this._apidomain+t+"/library/alerts"}_getSeenCount(e){var t=e.filter(e=>e.seen).length;return this.dispatchEvent(new CustomEvent("seen-count-changed",{bubbles:!0,composed:!0,detail:{seenCount:t}})),t}}window.customElements.define("uvalib-model-alerts",i);
