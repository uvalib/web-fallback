import{P as t}from"./uvalib-ui-base-d828b1c1.js";
/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/var e=/\.splices$/,i=/\.length$/,n=/\.?#?([0-9]+)$/;
/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
t({is:"app-localstorage-document",_template:null,behaviors:[{properties:{data:{type:Object,notify:!0,value:function(){return this.zeroValue}},sequentialTransactions:{type:Boolean,value:!1},log:{type:Boolean,value:!1}},observers:["__dataChanged(data.*)"],created:function(){this.__initialized=!1,this.__syncingToMemory=!1,this.__initializingStoredValue=null,this.__transactionQueueAdvances=Promise.resolve()},ready:function(){this._initializeStoredValue()},get isNew(){return!0},get transactionsComplete(){return this.__transactionQueueAdvances},get zeroValue(){},saveValue:function(t){return Promise.resolve()},reset:function(){},destroy:function(){return this.data=this.zeroValue,this.saveValue()},initializeStoredValue:function(){return this.isNew?Promise.resolve():this._getStoredValue("data").then(function(t){if(this._log("Got stored value!",t,this.data),null==t)return this._setStoredValue("data",this.data||this.zeroValue);this.syncToMemory((function(){this.set("data",t)}))}.bind(this))},getStoredValue:function(t){return Promise.resolve()},setStoredValue:function(t,e){return Promise.resolve(e)},memoryPathToStoragePath:function(t){return t},storagePathToMemoryPath:function(t){return t},syncToMemory:function(t){this.__syncingToMemory||(this._group("Sync to memory."),this.__syncingToMemory=!0,t.call(this),this.__syncingToMemory=!1,this._groupEnd("Sync to memory."))},valueIsEmpty:function(t){return Array.isArray(t)?0===t.length:Object.prototype.isPrototypeOf(t)?0===Object.keys(t).length:null==t},_getStoredValue:function(t){return this.getStoredValue(this.memoryPathToStoragePath(t))},_setStoredValue:function(t,e){return this.setStoredValue(this.memoryPathToStoragePath(t),e)},_enqueueTransaction:function(t){if(this.sequentialTransactions)t=t.bind(this);else{var e=t.call(this);t=function(){return e}}return this.__transactionQueueAdvances=this.__transactionQueueAdvances.then(t).catch(function(t){this._error("Error performing queued transaction.",t)}.bind(this))},_log:function(...t){this.log&&console.log.apply(console,t)},_error:function(...t){this.log&&console.error.apply(console,t)},_group:function(...t){this.log&&console.group.apply(console,t)},_groupEnd:function(...t){this.log&&console.groupEnd.apply(console,t)},_initializeStoredValue:function(){if(this.__initializingStoredValue)return null;this._group("Initializing stored value.");var t=this.__initializingStoredValue=this.initializeStoredValue().then(function(){this.__initialized=!0,this.__initializingStoredValue=null,this._groupEnd("Initializing stored value.")}.bind(this)).catch(function(t){this.__initializingStoredValue=null,this._groupEnd("Initializing stored value.")}.bind(this));return this._enqueueTransaction((function(){return t}))},__dataChanged:function(t){if(!this.isNew&&!this.__syncingToMemory&&this.__initialized&&!this.__pathCanBeIgnored(t.path)){var e=this.__normalizeMemoryPath(t.path),i=t.value,n=i&&i.indexSplices;this._enqueueTransaction((function(){return this._log("Setting",e+":",n||i),n&&this.__pathIsSplices(e)&&(e=this.__parentPath(e),i=this.get(e)),this._setStoredValue(e,i)}))}},__normalizeMemoryPath:function(t){for(var e=t.split("."),i=[],n=[],o=[],r=0;r<e.length;++r)n.push(e[r]),/^#/.test(e[r])?o.push(this.get(i).indexOf(this.get(n))):o.push(e[r]),i.push(e[r]);return o.join(".")},__parentPath:function(t){var e=t.split(".");return e.slice(0,e.length-1).join(".")},__pathCanBeIgnored:function(t){return i.test(t)&&Array.isArray(this.get(this.__parentPath(t)))},__pathIsSplices:function(t){return e.test(t)&&Array.isArray(this.get(this.__parentPath(t)))},__pathRefersToArray:function(t){return(e.test(t)||i.test(t))&&Array.isArray(this.get(this.__parentPath(t)))},__pathTailToIndex:function(t){var e=t.split(".").pop();return window.parseInt(e.replace(n,"$1"),10)}}],properties:{key:{type:String,notify:!0},sessionOnly:{type:Boolean,value:!1},storage:{type:Object,computed:"__computeStorage(sessionOnly)"}},observers:["__storageSourceChanged(storage, key)"],attached:function(){this.listen(window,"storage","__onStorage"),this.__isSameOrigin(window.top)&&this.listen(window.top,"app-local-storage-changed","__onAppLocalStorageChanged")},detached:function(){this.unlisten(window,"storage","__onStorage"),this.__isSameOrigin(window.top)&&this.unlisten(window.top,"app-local-storage-changed","__onAppLocalStorageChanged")},get isNew(){return!this.key},saveValue:function(t){try{this.__setStorageValue(t,this.data)}catch(t){return Promise.reject(t)}return this.key=t,Promise.resolve()},reset:function(){this.key=null,this.data=this.zeroValue},destroy:function(){try{this.storage.removeItem(this.key),this.reset()}catch(t){return Promise.reject(t)}return Promise.resolve()},getStoredValue:function(t){var e;if(null!=this.key)try{e=null!=(e=this.__parseValueFromStorage())?this.get(t,{data:e}):void 0}catch(t){return Promise.reject(t)}return Promise.resolve(e)},setStoredValue:function(t,e){if(null!=this.key){try{this.__setStorageValue(this.key,this.data)}catch(t){return Promise.reject(t)}this.__isSameOrigin(window.top)&&this.fire("app-local-storage-changed",this,{node:window.top})}return Promise.resolve(e)},__computeStorage:function(t){return t?window.sessionStorage:window.localStorage},__storageSourceChanged:function(t,e){this._initializeStoredValue()},__onStorage:function(t){t.key===this.key&&t.storageArea===this.storage&&this.syncToMemory((function(){this.set("data",this.__parseValueFromStorage())}))},__onAppLocalStorageChanged:function(t){t.detail!==this&&t.detail.key===this.key&&t.detail.storage===this.storage&&this.syncToMemory((function(){this.set("data",t.detail.data)}))},__parseValueFromStorage:function(){try{return JSON.parse(this.storage.getItem(this.key))}catch(t){console.error("Failed to parse value from storage for",this.key)}},__setStorageValue:function(t,e){void 0===e&&(e=null),this.storage.setItem(t,JSON.stringify(e))},__isSameOrigin:function(t){try{return window.location.host===t.location.host}catch(t){return!1}}});
